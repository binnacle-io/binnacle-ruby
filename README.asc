== Binnacle Ruby Client

## Ruby Client for the RESTful Distributed Event Logging and Multi-channel Push Service

....
__/\\\______________________________________________________________________________/\\\\\\____________________
_\/\\\_____________________________________________________________________________\////\\\____________________
_\/\\\__________/\\\__________________________________________________________________\/\\\____________________
_\/\\\_________\///____/\\/\\\\\\_____/\\/\\\\\\_____/\\\\\\\\\_________/\\\\\\\\_____\/\\\_________/\\\\\\\\__
_\/\\\\\\\\\____/\\\__\/\\\////\\\___\/\\\////\\\___\////////\\\______/\\\//////______\/\\\_______/\\\/////\\\_
_\/\\\////\\\__\/\\\__\/\\\__\//\\\__\/\\\__\//\\\____/\\\\\\\\\\____/\\\_____________\/\\\______/\\\\\\\\\\\__
_\/\\\__\/\\\__\/\\\__\/\\\___\/\\\__\/\\\___\/\\\___/\\\/////\\\___\//\\\____________\/\\\_____\//\\///////___
_\/\\\\\\\\\___\/\\\__\/\\\___\/\\\__\/\\\___\/\\\__\//\\\\\\\\/\\___\///\\\\\\\\___/\\\\\\\\\___\//\\\\\\\\\\_
_\/////////____\///___\///____\///___\///____\///____\////////\//______\////////___\/////////_____\//////////__
....

Overview
========
Send log messages to Binnacle

Drop in replacement for Ruby's Logger (See http://www.ruby-doc.org/stdlib-2.2.0/libdoc/logger/rdoc/Logger.html)

Building
========
- Build the Gem: `gem build binnacle.gemspec`
- Install the Gem Locally: `gem install ./binnacle-0.0.1.gem`

Usage
=====

### Via Ruby Client

Build an instance of Logging Adapter passing the following Binnacle configuration
values (get them from you App page on the Binnacle Website):

```
require 'binnacle'

client = Binnacle::Client.new('smx0kqbr0wbxnfpdalr5', '3hwkt7kcgtta2wqxy96c', 'http://localhost:8080')
client.signal!('5ujzd7gwk8ikmvnqv1w7', 'event_from_client', 'binnacle-ruby', '001','127.0.0.1','INFO')
```

Parameters to Client.new:

- account_id: Your Binnacle Account ID (`BINNACLE_ACCOUNT`)
- app_id: Your Binnacle App ID (`BINNACLE_APP`)
- endpoint_url: The Binnacle Endpoint URL (`BINNACLE_URL`)

All these values can be configured as ENV variables (variable name in parenthesis)

Parameters to signal:

- context_id: Your default Binnacle Context ID (`BINNACLE_CTX`)
- event_name: The name of the event
- client_id: Use for system/subsystem/component id/name
- session_id: Use to track a user session across requests/processes
- log_level: UNKNOWN, FATAL, ERROR, WARN, INFO, DEBUG
- tags (optional): An Array of tags, e.g. `['accounts', 'refunds', 'dispute']`
- json (optional): A Ruby Hash, e.g. `{ message: "there you are!" }`

### Via Ruby/Rails Logging

Build an instance of Logging Adapter (which wraps the Binnacle Client):

```
require 'binnacle'

logger = Binnacle::Logging.new('smx0kqbr0wbxnfpdalr5', '3hwkt7kcgtta2wqxy96c', '5ujzd7gwk8ikmvnqv1w7', 'http://localhost:8080')

logger.info("This is an info message")
logger.debug("This is an debug message")
```

Parameters to Logging.new:

- account_id: Your Binnacle Account ID (`BINNACLE_ACCOUNT`)
- app_id: Your Binnacle App ID (`BINNACLE_APP`)
- logging_context_id: Your default Binnacle Context ID (`BINNACLE_CTX`)
- endpoint_url: The Binnacle Endpoint URL (`BINNACLE_URL`)

The following log statement:

```
logger.info("hey")
```

results in the following message being sent to Binnacle:

```
{
  "accountId": "smx0kqbr0wbxnfpdalr5",
  "appId": "3hwkt7kcgtta2wqxy96c",
  "contextId": "5ujzd7gwk8ikmvnqv1w7",
  "sessionId": "",
  "clientEventTime": "2015-01-31T08:55:19-0700",
  "eventName": "log",
  "clientId": "",
  "logLevel": "INFO",
  "tags": [],
  "json": {"message":"hey"}
}
```

NOTE: `sessionId` and `clientId` are currently unset/unassigned

#### Specifying an event name

By default log message are recorded under the 'log' event name. To log under a
different event name we override Ruby's logger 'progname' parameter.

For example, the following log statement:

```
logger.info 'failed_transfer' { 'transfer failed, bad RTN' }
```

Will post to Binnacle under the event name `failed_transfer`

Integration
===========

### Rails 3.x

In config/environments/production.rb:

```
RailsApplication::Application.configure do
  config.logger = Binnacle::Logging.new('smx0kqbr0wbxnfpdalr5', '3hwkt7kcgtta2wqxy96c', '5ujzd7gwk8ikmvnqv1w7', 'http://localhost:8080')
end
```

### Rails 4

Create config/initializers/binnacle.rb:

```
binnacle = Binnacle::Logging.new('smx0kqbr0wbxnfpdalr5', '3hwkt7kcgtta2wqxy96c', '5ujzd7gwk8ikmvnqv1w7', 'http://localhost:8080')
Rails.logger.extend(ActiveSupport::Logger.broadcast(binnacle))
```
